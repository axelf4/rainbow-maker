<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<?!= include('jscolor'); ?>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css">

		<style>
html {
	overflow: -moz-scrollbars-vertical;
	overflow-y: scroll;
}

.colorCollection li span {
	text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
}
		</style>

		<script>
			function onFailure(error) {
			}

			function onSuccess() {
				google.script.host.close();
			}

			function saveAndClose() {
				var options = {};
				var randomColors = document.getElementById('randomColors').checked;
				var basicColors = document.getElementById('basicColors').checked;
				var customColors = document.getElementById('customColors').checked;

				if (randomColors) {
					options['method'] = "randomColors";
				} else if (basicColors) {
					options['method'] = "basicColors";
				} else if (customColors) {
					options['method'] = "customColors";
				}

				const hue = document.getElementById('hue');
				options['hue'] = hue.options[hue.selectedIndex].value;
				const luminosity = document.getElementById('luminosity');
				options['luminosity'] = luminosity.options[luminosity.selectedIndex].value;

				var colorString = "", colorChildren = document.getElementById("colorCollection").children;
				for (var i = 0, length = colorChildren.length; i < length; ++i) {
					if (i > 0) colorString += ";";
					colorString += colorChildren[i].getAttribute("color");
				}
				options['customColors'] = colorString;

				options.byWord = document.getElementById('byWord').checked;

				google.script.run.withSuccessHandler(onSuccess).withFailureHandler(onFailure).setOptions(options);
			}

			function removeColor(link) {
				var li = link.parentElement.parentElement;
				li.parentElement.removeChild(li);
			}

			function addColor(color) {
				var li = document.createElement("li");
				li.className = "collection-item";
				li.style.color = color;
				li.setAttribute("color", color);
				li.innerHTML = '<div><span>' + color + '</span><a class="secondary-content" onclick="removeColor(this)"><i class="material-icons">close</i></a></div>';

				var colorCollection = document.getElementById("colorCollection");
				colorCollection.appendChild(li);
			}

			function submitColor() {
				var color = "#" + document.getElementById("colorPicker").jscolor;
				addColor(color);
			}

			function selectOption(select, value) {
				for (var i = 0, length = select.options.length; i < length; ++i) {
					if(select.options[i].value == value) {
						select.selectedIndex = i;
						return;
					}
				}
				throw "Could not find value in select.";
			}
		</script>
	</head>
	<body>
		<div class="container">
			<h1>Options</h1>

			<form action="#">
				<ul class="collapsible" data-collapsible="accordion">
					<li>
						<div class="collapsible-header">
							<input type="radio" id="basicColors" name="options" <?= options.method == "basicColors" ? "checked" : "" ?> />
							<label for="basicColors">Basic colors</label>
						</div>
					</li>
					<li>
						<div class="collapsible-header">
							<div class="row">
								<div class="col s10">
									<input type="radio" id="randomColors" name="options" <?= options.method == "randomColors" ? "checked" : "" ?> />
									<label for="randomColors">Random colors</label>
								</div>
								<div class="col s2">
									<i class="material-icons">expand_more</i>
								</div>
							</div>
						</div>
						<div class="collapsible-body"><span>
								<div class="row">
									<p class="col s12">
									Use randomly generated nice colors.
									</p>
									<div class="input-field col s12">
										<select name="hue" id="hue">
											<option value="default">Default</option>
											<option value="red">Red</option>
											<option value="orange">Orange</option>
											<option value="yellow">Yellow</option>
											<option value="green">Green</option>
											<option value="blue">Blue</option>
											<option value="purple">Purple</option>
											<option value="pink">Pink</option>
											<option value="monochrome">Monochrome</option>
										</select>
										<label>Hue</label>
									</div>

									<div class="input-field col s12">
										<select name="luminosity" id="luminosity">
											<option value="default">Default</option>
											<option value="bright">Bright</option>
											<option value="light">Light</option>
											<option value="dark">Dark</option>
										</select>
										<label>Luminosity</label>
									</div>
								</div>
							</span></div>
					</li>
					<li>
						<div class="collapsible-header">
							<div class="row">
								<div class="col s10">
									<input type="radio" id="customColors" name="options" <?= options.method == "customColors" ? "checked" : "" ?> />
									<label for="customColors">Custom colors</label>
								</div>
								<div class="col s2">
									<i class="material-icons">expand_more</i>
								</div>
							</div>
						</div>
						<div class="collapsible-body"><span>
								<div class="row">
									<p class="col s12">
									Pick which colors should be chosen.
									</p>
									<br />
									<div class="col s4">
										<input class="jscolor" id="colorPicker" />
									</div>
									<div class="col s6 offset-s2">
										<a class="waves-effect waves-light btn" style="width: 100%;" onclick="submitColor()">Add</a>
									</div>
									<div class="col s12">
										<ul class="collection colorCollection" id="colorCollection"></ul>
									</div>
								</div>
							</span></div>
					</li>
				</ul>

				<input id="byWord" type="checkbox" <?= options.byWord ? "checked" : "" ?> />
				<label for="byWord">By word</label>

				<a class="waves-effect waves-light btn" style="margin-bottom: 15px;" onclick="saveAndClose()">Save and close</a>
			</form>
		</div>

		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"></script>
		<script>
			$(document).ready(function() {
				$('select').material_select();
				$('.collapsible').collapsible();
			});
			selectOption(document.getElementById("hue"), <?= options.hue ?>);
			selectOption(document.getElementById("luminosity"), <?= options.luminosity ?>);
			var colorStrings = <?= options.customColors ?>.split(";");
			if (colorStrings[0] !== "") for (var i = 0, length = colorStrings.length; i < length; ++i) {
				addColor(colorStrings[i]);
			}
		</script>
	</body>
</html>
